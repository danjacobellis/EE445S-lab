

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Lab 5. Digital Data Transmission by Baseband Pulse Amplitude Modulation (PAM) &mdash; 445S Lab Manual  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Lab 5 Primer" href="primer.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> 445S Lab Manual
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">EE 445S Lab Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../primer.html">Lab Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stm32h735g.html">STM32H735G Discovery Kit Setup Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Laboratory Hardware Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data.html">Managing data between MATLAB and C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab1/index.html">Lab 1. Overview of Hardware and Software Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab2/index.html">Lab 2. Generating Cosine and Sine Waves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab3/index.html">Lab 3. Digital Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab4/primer.html">Lab 4 Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab4/index.html">Lab 4. Pseudo-Random Binary Sequences and Data Scramblers</a></li>
<li class="toctree-l1"><a class="reference internal" href="primer.html">Lab 5 Primer</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lab 5. Digital Data Transmission by Baseband Pulse Amplitude Modulation (PAM)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#aim-of-the-experiment">Aim of the experiment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reading-assignment">Reading assignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lab-5-instructions-week-1">Lab 5 instructions: week 1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulation-in-matlab">Simulation in MATLAB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-transmitter-on-the-stm32-board">Setting up the transmitter on the STM32 board</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examining-the-transmission-in-matlab">Examining the transmission in MATLAB</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lab-5-instructions-week-2">Lab 5 instructions: week 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lab-5-instructions-week-3">Lab 5 instructions: week 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lab-report-contents">Lab report contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#i-introduction">I. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ii-methods">II. Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#iii-results-from-lab-exercise">III. Results from lab exercise</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#week-one">Week one</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#iv-discussion">IV. Discussion</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">445S Lab Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Lab 5. Digital Data Transmission by Baseband Pulse Amplitude Modulation (PAM)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/lab5/index.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="tex2jax_ignore mathjax_ignore section" id="lab-5-digital-data-transmission-by-baseband-pulse-amplitude-modulation-pam">
<h1>Lab 5. Digital Data Transmission by Baseband Pulse Amplitude Modulation (PAM)<a class="headerlink" href="#lab-5-digital-data-transmission-by-baseband-pulse-amplitude-modulation-pam" title="Permalink to this headline">¶</a></h1>
<div class="section" id="aim-of-the-experiment">
<h2>Aim of the experiment<a class="headerlink" href="#aim-of-the-experiment" title="Permalink to this headline">¶</a></h2>
<p>In this experiment, you will learn the basics concepts of digital communications like pulse shaping filters, Nyquist criterion, eye diagram, inter-symbol interference and clock recovery. You will learn digital data transmission using baseband pulse amplitude modulation.</p>
<p>Before you start with the experiment, it is necessary that you have an understanding (at some level) of the following concepts:</p>
<ul class="simple">
<li><p>Baseband PAM</p></li>
<li><p>Nyquist criterion</p></li>
<li><p>Inter-symbol Interference (ISI)</p></li>
<li><p>Pulse shaping (raised cosine baseband filtering)</p></li>
<li><p>Eye diagrams</p></li>
<li><p>Interpolation filter bank</p></li>
<li><p>Symbol clock recovery</p></li>
</ul>
</div>
<div class="section" id="reading-assignment">
<h2>Reading assignment<a class="headerlink" href="#reading-assignment" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Digital Signal Processing using Arm Cortex-M based Microcontrollers by Cem Ünsalan, M. Erkin Yücel, H. Deniz Gürhan.</p>
<ul>
<li><p>Chapter 9, sections 1-6</p></li>
</ul>
</li>
<li><p>Software Receiver Design by C. Richard Johnson, Jr., William A. Sethares and Andrew Klein</p>
<ul>
<li><p>Sections 2.6-2.16</p></li>
<li><p>Sections 9.1-9.4</p></li>
<li><p>Sections 10.1-10.4</p></li>
<li><p>Sections 11.1-11.6</p></li>
</ul>
</li>
<li><p>Course reader</p>
<ul>
<li><p>Lecture 7: Interpolation and Pulse Shaping</p></li>
<li><p>Lecture 13: Digital Pulse Amplitude Modulation (PAM transmitter)</p></li>
<li><p>Lecture 12: Channel Impairments (communication channel)</p></li>
<li><p>Lecture 14: Matched Filtering (PAM receiver)</p></li>
</ul>
</li>
<li><p>Common Microcontroller Software Interface Standard (CMSIS) Reference</p>
<ul>
<li><p><a class="reference external" href="https://arm-software.github.io/CMSIS_5/DSP/html/group__FIR__Interpolate.html">FIR Interpolating Filter</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="lab-5-instructions-week-1">
<h2>Lab 5 instructions: week 1<a class="headerlink" href="#lab-5-instructions-week-1" title="Permalink to this headline">¶</a></h2>
<p>In this exercise, we will transmit the scrambled tree image from the STM board to a PC running a receiver to recover the image.</p>
<div class="section" id="simulation-in-matlab">
<h3>Simulation in MATLAB<a class="headerlink" href="#simulation-in-matlab" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Run the following code which simulates the generation of the transmitted signal. Please download the <a class="reference external" href="https://danjacobellis.github.io/EE445S-lab/_sources/lab5/pn_16384.md.txt">file containing the PN sequence from lab four</a>, and the <a class="reference external" href="https://danjacobellis.github.io/EE445S-lab/_images/tree.png">tree image</a>. Ensure that both are accessible on the MATLAB path.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f0</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">;</span> <span class="n">fs</span> <span class="o">=</span> <span class="mi">48000</span><span class="p">;</span> <span class="n">sps</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span> <span class="n">fsym</span> <span class="o">=</span> <span class="n">fs</span><span class="o">/</span><span class="n">sps</span><span class="p">;</span>
<span class="n">pulse_shaping_filter</span> <span class="o">=</span> <span class="n">rcosdesign</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sps</span><span class="p">,</span><span class="s1">&#39;normal&#39;</span><span class="p">);</span>
<span class="n">carrier</span> <span class="o">=</span> <span class="o">@</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="n">theta</span><span class="p">);</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">fliplr</span><span class="p">(</span><span class="n">dec2bin</span><span class="p">(</span><span class="mi">2524737185</span><span class="p">))</span><span class="s1">&#39;);</span>
<span class="n">serialized_data</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;tree.png&#39;</span><span class="p">),[</span><span class="mi">1</span><span class="p">,</span><span class="mi">128</span><span class="o">^</span><span class="mi">2</span><span class="p">])</span><span class="s1">&#39;;</span>
<span class="n">pn16k</span> <span class="o">=</span> <span class="n">readmatrix</span><span class="p">(</span><span class="s1">&#39;pn_16384.txt&#39;</span><span class="p">)</span><span class="s1">&#39;; pn16k = pn16k(:);</span>
<span class="n">pn16k</span> <span class="o">=</span> <span class="n">fliplr</span><span class="p">(</span><span class="n">dec2bin</span><span class="p">(</span><span class="n">pn16k</span><span class="p">))</span><span class="s1">&#39;; pn16k = str2num(pn16k(:));</span>
<span class="n">scrambled</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">serialized_data</span> <span class="o">+</span> <span class="n">pn16k</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">upsampled_data</span> <span class="o">=</span> <span class="n">upsample</span><span class="p">([</span><span class="n">header</span><span class="p">;</span> <span class="n">scrambled</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">);</span>
<span class="n">sequence_of_pulses</span> <span class="o">=</span> <span class="n">conv</span><span class="p">(</span><span class="n">upsampled_data</span><span class="p">,</span><span class="n">pulse_shaping_filter</span><span class="p">,</span><span class="s1">&#39;same&#39;</span><span class="p">);</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">sequence_of_pulses</span><span class="p">);</span>
<span class="n">modulated</span> <span class="o">=</span> <span class="n">sequence_of_pulses</span><span class="s1">&#39; .* carrier(n,0);</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Create an eye diagram using the first 1600 samples of the simulated signal. You can either use the ‘eyediagram’ function in the communications toolbox or reshape the samples into a matrix and use ‘plot’. <strong>Include the eye diagram in your lab report.</strong></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">eyediagram</span><span class="p">(</span><span class="n">sequence_of_pulses</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1600</span><span class="p">),</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">;</span> <span class="n">plot</span><span class="p">(</span><span class="n">reshape</span><span class="p">(</span><span class="n">sequence_of_pulses</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1600</span><span class="p">),[</span><span class="mi">16</span><span class="p">,</span><span class="mi">100</span><span class="p">]));</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-the-transmitter-on-the-stm32-board">
<h3>Setting up the transmitter on the STM32 board<a class="headerlink" href="#setting-up-the-transmitter-on-the-stm32-board" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>In lab.c, create an array containing the data stream to transmit. The data stream will have 32 bits of header followed by 16384 bits for the (scrambled) tree image. If we store it as an array of 32-bit words, then we will need an array of length 513.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uint32_t</span> <span class="n">data_stream</span><span class="p">[</span><span class="mi">513</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</pre></div>
</div>
<p>For the header sequence, we will use the output of a maximal-length 5-bit LFSR. Rather than repeat the steps from lab 4 to generate the sequence, you can simply copy the provided sequence which has been computed for you.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_stream</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x967c6ea1</span><span class="p">;</span>
</pre></div>
</div>
<p>The tree data and scrambler are the same as lab four. Populate the remainder of the <code class="docutils literal notranslate"><span class="pre">data_stream</span></code> array with the scrambled tree (<code class="docutils literal notranslate"><span class="pre">tree[i]^PN[i]</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">i_word</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_word</span> <span class="o">&lt;</span> <span class="mi">512</span><span class="p">;</span> <span class="n">i_word</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">data_stream</span><span class="p">[</span><span class="n">i_word</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">i_word</span><span class="p">]</span><span class="o">^</span><span class="n">PN</span><span class="p">[</span><span class="n">i_word</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Prepare the pulse-shaping filter according the specifications below. Since the interpolating filterbank requires a filter whose length is a multiple of the upsampling factor (16), remove the last coefficient (which should be equal to zero and has no effect on the filter)</p>
<ul class="simple">
<li><p>Filter type: raised cosine</p></li>
<li><p>Samples per symbol: 16</p></li>
<li><p>Sampling Frequency <span class="math notranslate nohighlight">\(F_s= 44.1 \text{ kHz}\)</span></p></li>
<li><p>Rolloff factor: 0.8</p></li>
</ul>
<p>In MATLAB, use the ‘rcosdesign’ function and copy the coefficients into lab.c</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pulse_shaping_coeffs</span> <span class="o">=</span> <span class="n">rcosdesign</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">);</span>
<span class="n">sprintf</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">,&#39;</span><span class="p">,</span><span class="n">pulse_shaping_coeffs</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">end</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">float32_t</span> <span class="n">pulse_shaping_coeffs</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">&lt;</span><span class="n">coefficients</span><span class="o">&gt;</span><span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>In lab.c prepare the variables necessary to use the CMSIS library function for the interpolating filter. Take a moment to read the <a class="reference external" href="https://arm-software.github.io/CMSIS_5/DSP/html/group__FIR__Interpolate.html">description of the FIR interpolator function.</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arm_fir_interpolate_instance_f32</span> <span class="n">filter_instance</span><span class="p">;</span> 
<span class="n">uint8_t</span> <span class="n">upsampling_factor</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
<span class="n">uint16_t</span> <span class="n">num_taps</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
<span class="n">float32_t</span> <span class="n">state</span><span class="p">[(</span><span class="n">FRAME_SIZE</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="n">float32_t</span> <span class="n">filter_in</span><span class="p">[</span><span class="n">FRAME_SIZE</span><span class="o">/</span><span class="mi">64</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="n">float32_t</span> <span class="n">filter_out</span><span class="p">[</span><span class="n">FRAME_SIZE</span><span class="o">/</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="n">float32_t</span> <span class="n">cos_lut</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
<span class="n">uint32_t</span> <span class="n">i_lut</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Also create variables to keep track of our current word and bit position in the data stream (just as you did in lab 4). You can reuse the variables you used for the PN sequence as long as you reset them.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uint32_t</span> <span class="n">i_word</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">uint32_t</span> <span class="n">i_bit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Initialize the interpolating filter in the lab_init function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arm_fir_interpolate_init_f32</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">filter_instance</span><span class="p">,</span> <span class="n">upsampling_factor</span><span class="p">,</span> <span class="n">num_taps</span><span class="p">,</span> <span class="n">pulse_shaping_coeffs</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">FRAME_SIZE</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>In process_input_buffer, construct the buffer of symbols that we will send to the arm_fir_interpolate_f32 function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">uint32_t</span> <span class="n">i_sample</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_sample</span><span class="o">&lt;</span><span class="n">FRAME_SIZE</span><span class="o">/</span><span class="mi">64</span><span class="p">;</span> <span class="n">i_sample</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">filter_in</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">data_stream</span><span class="p">[</span><span class="n">i_word</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i_bit</span><span class="p">)</span> <span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">i_bit</span><span class="p">;</span>
    <span class="n">filter_in</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter_in</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">i_bit</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i_bit</span> <span class="o">==</span> <span class="mi">32</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">i_word</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">i_bit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i_word</span> <span class="o">&gt;</span> <span class="mi">512</span><span class="p">){</span><span class="n">i_word</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Perform the filtering and copy the result to the output buffer</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arm_fir_interpolate_f32</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">filter_instance</span><span class="p">,</span> <span class="n">filter_in</span><span class="p">,</span> <span class="n">filter_out</span><span class="p">,</span> <span class="n">FRAME_SIZE</span><span class="o">/</span><span class="mi">64</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="n">uint32_t</span> <span class="n">i_sample</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_sample</span> <span class="o">&lt;</span> <span class="n">FRAME_SIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="n">i_sample</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
     <span class="n">input_buffer</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span> <span class="o">=</span> <span class="n">OUTPUT_SCALE_FACTOR</span><span class="o">*</span><span class="n">filter_out</span><span class="p">[</span><span class="n">i_sample</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">cos_lut</span><span class="p">[</span><span class="n">i_lut</span><span class="p">];</span>
     <span class="n">i_lut</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_lut</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
     <span class="n">i_sample</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
     <span class="n">input_buffer</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="examining-the-transmission-in-matlab">
<h3>Examining the transmission in MATLAB<a class="headerlink" href="#examining-the-transmission-in-matlab" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>With the transmitter running, record 12 seconds of data using MATLAB and save it to a file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span> <span class="o">=</span> <span class="mi">48000</span><span class="p">;</span>
<span class="n">recorder</span> <span class="o">=</span> <span class="n">audiorecorder</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">recordblocking</span><span class="p">(</span><span class="n">recorder</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="n">scrambled</span> <span class="o">=</span> <span class="n">getaudiodata</span><span class="p">(</span><span class="n">recorder</span><span class="p">)</span><span class="s1">&#39;;</span>
<span class="n">save</span> <span class="n">scrambled</span> <span class="n">scrambled</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Remove the scrambler by replacing the line <code class="docutils literal notranslate"><span class="pre">data_stream[i_word+1]</span> <span class="pre">=</span> <span class="pre">tree[i_word]^PN[i_word];</span></code> with <code class="docutils literal notranslate"><span class="pre">data_stream[i_word+1]</span> <span class="pre">=</span> <span class="pre">tree[i_word]</span></code>. Repeat the recording, but ensure that you choose a new file name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span> <span class="o">=</span> <span class="mi">48000</span><span class="p">;</span>
<span class="n">recorder</span> <span class="o">=</span> <span class="n">audiorecorder</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">recordblocking</span><span class="p">(</span><span class="n">recorder</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="n">not_scrambled</span> <span class="o">=</span> <span class="n">getaudiodata</span><span class="p">(</span><span class="n">recorder</span><span class="p">)</span><span class="s1">&#39;;</span>
<span class="n">save</span> <span class="n">not_scrambled</span> <span class="n">not_scrambled</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Create a spectrogram for both recorded transmissions. <strong>Include both spectrograms in your lab report.</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span> <span class="n">scrambled</span><span class="p">;</span>
<span class="n">figure</span><span class="p">;</span> <span class="n">spectrogram</span><span class="p">(</span><span class="n">scrambled</span><span class="p">,</span><span class="mi">2</span><span class="o">^</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">^</span><span class="mi">10</span><span class="p">,</span><span class="mi">48000</span><span class="p">,</span><span class="s1">&#39;yaxis&#39;</span><span class="p">);</span>

<span class="n">load</span> <span class="n">not_scrambled</span><span class="p">;</span>
<span class="n">figure</span><span class="p">;</span> <span class="n">spectrogram</span><span class="p">(</span><span class="n">not_scrambled</span><span class="p">,</span><span class="mi">2</span><span class="o">^</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">^</span><span class="mi">10</span><span class="p">,</span><span class="mi">48000</span><span class="p">,</span><span class="s1">&#39;yaxis&#39;</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Run the <a class="reference external" href="https://github.com/danjacobellis/EE445S-lab/raw/main/starter_code/receiver_demo.m">receiver demo</a> in MATLAB using the transmission that was not scrambled. Try to adjust the parameters to recover the tree image. <strong>Include the recovered tree image in your lab report using the best parameters you find.</strong></p></li>
</ol>
</div>
</div>
<div class="section" id="lab-5-instructions-week-2">
<h2>Lab 5 instructions: week 2<a class="headerlink" href="#lab-5-instructions-week-2" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="lab-5-instructions-week-3">
<h2>Lab 5 instructions: week 3<a class="headerlink" href="#lab-5-instructions-week-3" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="lab-report-contents">
<h2>Lab report contents<a class="headerlink" href="#lab-report-contents" title="Permalink to this headline">¶</a></h2>
<p>Be sure to include everything listed in this section when you submit your lab report. The goal of the report is to help cement what you learned in memory. For sections I, II, and IV, imagine your audience is a student who is your peer but who has not yet completed the lab.</p>
<div class="section" id="i-introduction">
<h3>I. Introduction<a class="headerlink" href="#i-introduction" title="Permalink to this headline">¶</a></h3>
<p>Briefly explain the theory and algorithms behind the programs that you wrote. The slides and reading material might help you in writing this section.</p>
</div>
<div class="section" id="ii-methods">
<h3>II. Methods<a class="headerlink" href="#ii-methods" title="Permalink to this headline">¶</a></h3>
<p>Describe the steps you took to implement the algorithms in your own words.</p>
</div>
<div class="section" id="iii-results-from-lab-exercise">
<h3>III. Results from lab exercise<a class="headerlink" href="#iii-results-from-lab-exercise" title="Permalink to this headline">¶</a></h3>
<p>Present the results you obtain for each task on the assignment sheet. This section should include illustrative oscilloscope screenshots of the DSP algorithms in action. Also include any code that you wrote or modified. Please do not include all of the boilerplate code from the textbook.</p>
<div class="section" id="week-one">
<h4>Week one<a class="headerlink" href="#week-one" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Eye diagram of simulated transmission</p></li>
<li><p>Spectrograms of PAM transmissions</p></li>
<li><p>Recovered tree image</p></li>
</ul>
</div>
</div>
<div class="section" id="iv-discussion">
<h3>IV. Discussion<a class="headerlink" href="#iv-discussion" title="Permalink to this headline">¶</a></h3>
<p>In this section, discuss the takeaway from each lab. You can mention any intuition that you developed. Also mention any problems that you faced and how you rectified them.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="primer.html" class="btn btn-neutral float-left" title="Lab 5 Primer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>